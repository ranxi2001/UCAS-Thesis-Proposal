# ==============================================================================
# Latexmk 配置文件 - XeLaTeX + BibTeX 完整编译方案
# ==============================================================================

# ------------------------------------------------------------------------------
# 编译器设置
# ------------------------------------------------------------------------------
# 使用 XeLaTeX 编译器（适合中文文档）
$pdf_mode = 5;  # 1=pdflatex, 4=lualatex, 5=xelatex

# XeLaTeX 编译命令（不使用 -halt-on-error，允许继续处理警告）
$xelatex = 'xelatex -synctex=1 -interaction=nonstopmode -file-line-error %O %S';

# BibTeX 编译命令
$bibtex = 'bibtex %O %B';

# ------------------------------------------------------------------------------
# 参考文献处理
# ------------------------------------------------------------------------------
# 自动检测是否需要运行 bibtex（根据 .aux 文件变化智能判断）
$bibtex_use = 1.5;  # 0=不使用, 1=仅在需要时, 1.5=智能检测, 2=总是运行

# ------------------------------------------------------------------------------
# 编译重试设置
# ------------------------------------------------------------------------------
# 最大重试次数（确保所有交叉引用、目录、参考文献都正确解析）
$max_repeat = 5;

# 强制模式：即使有警告也继续编译（microtype 包在 XeLaTeX 下会有警告）
# 0 = 遇到错误停止, 1 = 忽略错误继续, 2 = 只要生成了输出文件就继续
$force_mode = 1;

# ------------------------------------------------------------------------------
# 输出和清理设置
# ------------------------------------------------------------------------------
# 输出目录（如果需要可以指定，注释掉表示在源文件目录生成）
# $out_dir = 'build';

# 清理时要删除的辅助文件类型
$clean_ext = 'aux bbl blg fdb_latexmk fls log out synctex.gz toc xdv run.xml';

# 完全清理时额外删除的文件（latexmk -C）
$clean_full_ext = 'pdf nav snm vrb';

# ------------------------------------------------------------------------------
# 预览和查看器设置
# ------------------------------------------------------------------------------
# PDF 预览模式（0=不预览, 1=预览）
$preview_mode = 0;

# 连续预览模式（latexmk -pvc）
$preview_continuous_mode = 0;

# ------------------------------------------------------------------------------
# 自定义依赖关系
# ------------------------------------------------------------------------------
# 当检测到需要重新运行 LaTeX 时的模式
$go_mode = 0;  # 0=停止并报告, 1=继续编译

# 更新文件检查
$recorder = 1;  # 使用 -recorder 选项记录文件依赖

# ------------------------------------------------------------------------------
# 错误处理
# ------------------------------------------------------------------------------
# 警告处理 - 不把警告当作错误
$warnings_as_errors = 0;

# 忽略 microtype 在 XeLaTeX 下的警告（这些是正常的，不影响输出）
$silence_logfile_warnings = 1;

# ==============================================================================
# 说明：
# - 使用 "latexmk Thesis.tex" 进行完整自动编译
# - 使用 "latexmk -c" 清理辅助文件
# - 使用 "latexmk -C" 清理所有生成文件（包括 PDF）
# - 使用 "latexmk -g" 强制完全重新编译
# ==============================================================================
